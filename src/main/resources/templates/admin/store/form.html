<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layout/layout}">

<th:block layout:fragment="main">
    <main id="main" class="center-details" data-page>
        <section class="section" th:object="${store}">            
            <form class="form wide" th:action="@{./process}" method="post" name="form">    

                <span class="form-title" th:text="|가맹점 ${mode eq 'insert' ? '등록':'상세'}|"></span>
                <button type="button" onclick="storeDelete()" class="btn-normal btn-red position_abs">삭제</button>

                <fieldset class="fieldset">
                    <span class="input-wrap" th:if="${mode == 'update'}">
                        <label class="label" for="storeNo">가맹점 번호</label>
                        <input class="input" type="text" th:field="*{storeNo}" readonly>
                    </span>

                    <span class="input-wrap">
                        <label class="label" for="name">가맹점 이름</label>
                        <input class="input" type="text" th:field="*{name}"  maxlength="255">
                    </span>

                    <span class="input-wrap">
                        <label class="label" for="phone">가맹점 연락처</label>
                        <input class="input" type="text" th:field="*{phone}"  maxlength="255">
                    </span>
                             
                    <span class="input-wrap">
                        <label class="label">노출상태</label>
                        <div class="input-group">
                            <div class="check-wrap">
                                <div class="check">
                                    <input type="radio" id="exposureStatus01" 
                                           name="exposureStatus" value="false" 
                                           th:checked="${store.exposureStatus != null and !store.exposureStatus}">
                                    <label for="exposureStatus01">미노출</label>
                                </div>
                                <div class="check">
                                    <input type="radio" id="exposureStatus02" 
                                           name="exposureStatus" value="true" 
                                           th:checked="${store.exposureStatus != null and store.exposureStatus}">
                                    <label for="exposureStatus02">노출</label>
                                </div>
                            </div>
                        </div>
                    </span>
                    
                
                    <span class="input-wrap">
                        <label class="label">매장 서비스</label>
                        <div class="input-group">
                            <div class="check-wrap" id="service_form">
                                <div class="check">
                                    <input type="checkbox" id="service01" 
                                        name="serviceCheckbox" value="포장"
                                        onchange="serviceCheckHandler(this.value)" 
                                        th:checked="${store.service != null and #strings.contains(store.service,'포장')}">
                                    <label for="service01">포장</label>
                                </div>
                                <div class="check">
                                    <input type="checkbox" id="service02" 
                                        name="serviceCheckbox" value="배달"
                                        onchange="serviceCheckHandler(this.value)" 
                                        th:checked="${store.service != null and #strings.contains(store.service,'배달')}">
                                    <label for="service02">배달</label>
                                </div>
                                <div class="check">
                                    <input type="checkbox" id="service03" 
                                        name="serviceCheckbox" value="홀"
                                        onchange="serviceCheckHandler(this.value)"   
                                        th:checked="${store.service != null and #strings.contains(store.service,'홀')}">
                                    <label for="service03">홀</label>
                                </div>
                                <div class="check">
                                    <input type="checkbox" id="service04" 
                                        name="serviceCheckbox" value="주차"
                                        onchange="serviceCheckHandler(this.value)" 
                                        th:checked="${store.service != null and #strings.contains(store.service,'주차')}">
                                    <label for="service04">주차</label>
                                </div>
                                <input type="hidden" th:field="*{service}"/>
                            </div>
                        </div>
                    </span>

                    <span class="input-wrap search-wrap">
                        <label class="label" >주소</label>
                        <input class="input input-addr" type="text" style="border: 1px solid #dbdbdb !important;" th:field="*{address}" readonly>
                        <button type="button" class="btn modalBtn"  data-modal="map">주소검색</button>
                    </span>

                    <span class="input-wrap" th:if="${mode == 'update'}">
                        <label class="label" for="createDate">등록일자</label>
                        <input class="input" type="text" th:field="*{createDate}" readonly>
                    </span>

                    <span class="input-wrap" th:if="${mode == 'update'}">
                        <label class="label" for="updateDate">수정일자</label>
                        <input class="input" type="text" th:field="*{updateDate}" readonly>
                    </span>
                </fieldset>
            </form>
            <div class="form_action bottom" form="profileForm">
                <button type="button" class="btn-prime" th:onclick="process()" th:text="${mode == 'insert' ? '등록' : '수정'}"></button>
                <a th:href="@{./list}" class="btn-normal">취소</a>
            </div>
        </section>
    </main>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const mode = /*[[${mode}]]*/'';                    
        /*]]>*/

        function process() {                                                                        
            ajax(`/admin/store/${mode}`, 'POST', {
				storeNo: form.storeNo ? form.storeNo.value : 0,
                name: form.name.value,
                phone: form.phone.value,
                exposureStatus: form.exposureStatus.value,
                service: form.service.value,
                address: form.address.value,
			})
			  .then((data) => {
			  	alert(data.message);
                location.reload();
			  })
			  .catch((error) => console.log(error));
        }

        function storeDelete() {
            ajax(`./delete/${form.storeNo.value}`, 'POST')
			  .then((data) => {
			  	alert(data.message);
                location.href="./list";
			  })
			  .catch((error) => console.log(error));
        }

        function serviceCheckHandler(value)  {  
            const service = document.getElementById('service');
            service.value += service.value === '' ? value : `,${value}`;
        }

        window.addEventListener('DOMContentLoaded', () => {
            numberOnly();
            layoutFn();
        });
    </script>
</th:block>

</html>